<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mecze Blanki</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        /* 1. Ogólne style dla strony */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #ffffff;
            color: #333;
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .primary-btn {
            background-color: #0078d7;
            color: white;
            padding: 8px 16px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .primary-btn:hover {
            background-color: #005bb5;
        }

        .pagination {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        /* 2. Nagłówek */
        header {
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            color: #333;
        }

        /* 3. Kalendarz */
        .calendar-container {
            width: 1200px; /* Stała szerokość */
            margin: 20px auto;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border: 2px solid #0078d7; /* Obramowanie */
            position: relative; /* Umożliwia pozycjonowanie przycisków nawigacyjnych */
            padding-bottom: 80px; /* Dodajemy większy margines dolny */
        }

        .calendar-week {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .calendar-day {
            flex: 1;
            text-align: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            min-height: 150px; /* Minimalna wysokość */
            max-height: 200px; /* Maksymalna wysokość */
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Wydarzenia od góry */
            min-width: 120px;
            overflow-y: auto; /* Scrollowanie w pionie */
        }

        .calendar-day h3 {
            white-space: nowrap; /* Zapobiega zawijaniu tekstu */
            font-size: 14px; /* Dostosuj rozmiar czcionki */
            margin: 0; /* Usuwa domyślny margines */
        }

        .calendar-day.past {
            background-color: #f8f9fa;
            opacity: 0.7;
        }

        .calendar-day.current {
            background-color: #e3f2fd;
            border: 2px solid #2196f3;
        }

        .event-item {
            display: flex;
            align-items: center; /* Wyśrodkowanie ikony w pionie */
            gap: 8px;
            padding: 6px;
            margin: 4px 0;
            background-color: #fff;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            height: 80px; /* Stała wysokość na 4 linie */
            cursor: pointer; /* Klikalny event */
        }

        .event-icon {
            width: 32px;
            height: 32px;
            background-color: #eee;
            border-radius: 4px;
            flex-shrink: 0;
            background-size: cover; /* Dopasowanie ikony */
        }

        .event-text {
            flex-grow: 1;
            text-align: left;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            justify-content: center; /* Wyśrodkowanie tekstu w pionie */
            line-height: 1.2; /* Zmniejszenie odstępów między liniami */
        }

        .event-text strong {
            white-space: nowrap; /* Zapobiega zawijaniu tytułu */
            overflow: hidden; /* Ukrywa nadmiarowy tekst */
            text-overflow: ellipsis; /* Dodaje "..." jeśli tekst jest za długi */
            max-width: 200px; /* Maksymalna szerokość tytułu */
            margin-bottom: 2px; /* Mniejszy odstęp między liniami */
        }

        .event-text small {
            font-size: 12px; /* Mniejszy rozmiar czcionki dla adresu */
            margin-top: 2px; /* Mniejszy odstęp między liniami */
        }

        /* Style dla przycisków nawigacyjnych kalendarza */
        .navigation-buttons {
            position: absolute; /* Pozycjonowanie absolutne */
            bottom: 20px; /* 20px od dolnej krawędzi kontenera */
            left: 50%; /* Wyśrodkowanie w poziomie */
            transform: translateX(-50%); /* Wyśrodkowanie w poziomie */
            display: flex;
            gap: 10px; /* Odstęp między przyciskami */
        }

        /* 4. Wybór zespołu i notatki */
        .team-and-notes-container {
            display: flex;
            gap: 20px;
            width: 1200px;
            margin: 20px auto;
            position: relative; /* Umożliwia pozycjonowanie przycisków nawigacyjnych */
        }

        .team-selection-container {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 20px;
            width: 600px;
            height: 320px;
            border: 2px solid #0078d7;
            border-radius: 8px;
            padding: 15px;
            background-color: #f8f9fa;
            position: relative; /* Umożliwia pozycjonowanie przycisku "Gramy" */
        }

        /* Logo po lewej stronie */
        .team-logo-container {
            flex-shrink: 0;
            display: flex;
            justify-content: left;
            align-items: center;
        }

        .team-logo {
            width: 300px;
            height: 300px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Formularz po prawej */
        .team-info-container {
            display: flex;
            flex-direction: column; /* Ustawiamy przyciski w kolumnie */
            align-items: flex-start;
            gap: 10px; /* Odstęp między elementami */
            position: relative; /* Umożliwia pozycjonowanie przycisku "Gramy" */
            padding-bottom: 80px; /* Dodajemy miejsce na przycisk "Gramy" */
        }

        /* Styl dla SELECT i INPUT (data) */
        .team-selector, .date-input {
            width: 200px;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            appearance: none; /* Usuwa domyślne strzałki w select/input[type="date"] */
            -webkit-appearance: none; /* Safari */
            -moz-appearance: none; /* Firefox */
            margin-bottom: 10px; /* Dodajemy margines dolny */
        }

        /* Efekt hover i focus dla obu pól */
        .team-selector:hover, .date-input:hover,
        .team-selector:focus, .date-input:focus {
            border-color: #0078d7;
            outline: none;
        }

        /* Styl przycisku "Gramy" */
        .team-info-container .primary-btn {
            position: absolute; /* Pozycjonowanie absolutne */
            bottom: 10px; /* 10px od dolnej krawędzi kontenera */
            left: 50%; /* Wyśrodkowanie w poziomie */
            transform: translateX(-50%); /* Wyśrodkowanie w poziomie */
            margin-top: 10px; /* Górny margines 10px */
        }

        .scouting-notes {
            width: 600px; /* Stała szerokość */
            height: 330px; /* Stała wysokość */
            overflow-y: auto; /* Przewijanie pionowe, jeśli zawartość jest zbyt długa */
            display: flex;
            flex-direction: column;
            gap: 10px;
            border: 2px solid #0078d7; /* Obramowanie */
            border-radius: 8px;
            padding: 10px;
            background-color: #f8f9fa;
            position: relative; /* Umożliwia pozycjonowanie przycisków nawigacyjnych */
        }

        .notes-display {
            padding: 10px;
            background-color: #fff;
            border-radius: 4px;
            margin-bottom: 10px;
            max-height: 200px; /* Ograniczenie wysokości notatki */
            overflow-y: auto; /* Przewijanie pionowe, jeśli tekst jest zbyt długi */
        }

        .notes-display p {
            margin: 5px 0;
            text-align: left; /* Tekst wyrównany do lewej */
            word-wrap: break-word; /* Zawijanie długich słów */
            white-space: pre-wrap; /* Zachowuje formatowanie tekstu (np. nowe linie) */
            font-size: 14px; /* Standardowy rozmiar czcionki */
        }

        /* Wyśrodkowanie przycisków nawigacji dla notatek */
        .notes-navigation {
            position: absolute; /* Pozycjonowanie absolutne */
            bottom: 10px; /* 10px od dolnej krawędzi kontenera */
            left: 50%; /* Wyśrodkowanie w poziomie */
            transform: translateX(-50%); /* Wyśrodkowanie w poziomie */
            display: flex;
            gap: 10px; /* Odstęp między przyciskami */
        }

        /* Wyśrodkowanie przycisków nawigacji dla statystyk */
        #pagination {
            display: flex;
            justify-content: center; /* Wyśrodkowanie w poziomie */
            align-items: center; /* Wyśrodkowanie w pionie */
            gap: 10px; /* Odstęp między przyciskami */
            margin-top: 10px;
            position: relative; /* Umożliwia pozycjonowanie przycisków nawigacyjnych */
        }

        .notes-navigation button {
            background-color: #0078d7;
            color: white;
            padding: 8px 16px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .notes-navigation button:hover {
            background-color: #005bb5;
        }

        .notes-navigation button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* 5. Statystyki */
        .stats-container {
            width: 1200px; /* Stała szerokość */
            margin: 20px auto;
            border: 2px solid #0078d7; /* Obramowanie */
            border-radius: 8px;
            padding: 20px;
            background-color: #f9f9f9;
        }

        #matches-table {
            width: 100%;
            border-collapse: collapse;
        }

        #matches-table th, #matches-table td {
            padding: 8px;
            font-size: 14px;
            text-align: center;
            border: 1px solid #ddd;
            white-space: nowrap;
        }

        #matches-table th {
            background-color: #f2f2f2;
        }

        /* 6. Responsywność */
        @media screen and (max-width: 768px) {
            .team-and-notes-container {
                flex-direction: column;
            }

            .calendar-week {
                flex-direction: column;
            }

            .navigation-buttons {
                flex-direction: column; /* Przyciski w kolumnie na małych ekranach */
                gap: 5px; /* Mniejszy odstęp */
            }

            .notes-navigation {
                flex-direction: column; /* Przyciski w kolumnie na małych ekranach */
                gap: 5px; /* Mniejszy odstęp */
            }
        }
    </style>
    <!-- Skrypt Google Identity Services do logowania -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
</head>
<body>
    <header>
        <h2>Mój planner:</h2>
    </header>
    <!-- Przycisk logowania przez Google -->
    <div id="g_id_onload"
     data-client_id="148953860327-72d408l9qvt34akmhaa1e37m4bvbto70.apps.googleusercontent.com"
     data-callback="handleCredentialResponse">
    </div>
    <div class="g_id_signin"
         data-type="standard"
         data-size="large"
         data-theme="outline"
         data-text="sign_in_with"
         data-shape="rectangular"
         data-logo_alignment="left">
    </div>

    <!-- Sekcja kalendarza -->
    <div class="calendar-container">
        <div class="calendar-week">
            <!-- Dni tygodnia będą generowane dynamicznie -->
        </div>
        <!-- Przyciski nawigacyjne -->
        <div class="navigation-buttons">
            <button class="primary-btn" onclick="moveCalendar(-1)">Poprzednia</button>
            <button class="primary-btn add-event" onclick="addEvent()">+ Dodaj wydarzenie</button>
            <button class="primary-btn" onclick="moveCalendar(1)">Następna</button>
        </div>
    </div>

    <header>
        <h2>Najbliższy przeciwnik:</h2>
    </header>

    <!-- Kontener na wybór przeciwnika i notatki -->
    <div class="team-and-notes-container">
        <!-- Wybór przeciwnika -->
        <div class="team-selection-container">
            <div class="team-logo-container">
                <img id="team-logo" src="BAT Sierakowice.png" alt="Logo drużyny" class="team-logo" style="width: 300px; height: 300px;">
            </div>
            <div class="team-info-container">
                <select id="team-selector" class="team-selector" onchange="changeLogo()">
                    <option value="BAT Sierakowice">BAT Sierakowice</option>
                    <option value="BAT Kartuzy">BAT Kartuzy</option>
                    <option value="Bryza Pruszcz Gd">Bryza Pruszcz Gd</option>
                    <option value="Elbląg">Elbląg</option>
                    <option value="Pruszcz Gdański 1">Pruszcz Gdański 1</option>
                    <option value="Pruszcz Gdański 2">Pruszcz Gdański 2</option>
                    <option value="BK VLCI Žďár">BK VLCI Žďár</option>
                    <option value="BKM Žilina">BKM Žilina</option>
                    <option value="MOSiR Bochnia">MOSiR Bochnia</option>
                    <option value="UKS ŻAK Nowy Sącz">UKS ŻAK Nowy Sącz</option>
                    <option value="Young Angels Košice">Young Angels Košice</option>
                </select>
                <input type="date" id="game-date">
                <button class="primary-btn" onclick="startGame()">Gramy</button>
            </div>
        </div>

        <!-- Pole na notatki -->
        <div class="scouting-notes">
            <div class="notes-display" id="notes-display">
                <p>Tutaj dodaj swoje spostrzeżenia na temat przeciwnika. Kliknij "Dodaj".</p>
            </div>
            <!-- Przyciski nawigacyjne -->
            <div class="notes-navigation" id="notes-navigation">
                <button class="primary-btn" onclick="prevNote()">Poprzednia</button>
                <button class="primary-btn" onclick="editNote()">Edytuj</button>
                <button class="primary-btn" onclick="openNotesForm()">Dodaj</button>
                <button class="primary-btn" onclick="nextNote()">Następna</button>
            </div>
        </div>
    </div>

    <header>
        <h2>Moje statystyki:</h2>
    </header>
    <div class="stats-container">
        <!-- Tabela meczów -->
        <table id="matches-table">
            <thead>
                <tr>
                    <th>Drużyna</th>
                    <th>Data meczu</th>
                    <th>Punkty</th>
                    <th>Asysty</th>
                    <th>Bloki</th>
                    <th>Zbiórki</th>
                    <th>Przechwyty</th>
                    <th></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <!-- Paginacja -->
        <div id="pagination" style="margin-top: 10px;">
            <button id="prev-btn" class="primary-btn" onclick="changePage(-1)" disabled>Poprzednia</button>
            <button id="next-btn" class="primary-btn" onclick="changePage(1)" disabled>Następna</button>
        </div>
    </div>


    <!-- Reszta Twojej strony -->
<script>
    // Słownik z logo drużyn
    const logos = {
        'BAT Sierakowice': 'BAT Sierakowice.png',
        'BAT Kartuzy': 'BAT Kartuzy.png',
        'Bryza Pruszcz Gd': 'Bryza Pruszcz Gd.png',
        'Elbląg': 'Elblag.png',
        'Pruszcz Gdański 1': 'Pruszcz Gdanski 1.png',
        'Pruszcz Gdański 2': 'Pruszcz Gdanski 2.png',
        'BK VLCI Žďár': 'BK VLCI Zdar.png',
        'BKM Žilina': 'BKM Zilina.png',
        'MOSiR Bochnia': 'MOSiR Bochnia.png',
        'UKS ŻAK Nowy Sącz': 'UKS ZAK Nowy Sacz.png',
        'Young Angels Košice': 'Young Angels Kosice.png'
    };

    // Zmienne globalne
    let currentWeekStart = new Date(); // Początek bieżącego tygodnia
    let notes = JSON.parse(localStorage.getItem('notes')) || {}; // Notatki
    let currentTeam = 'BAT Sierakowice'; // Domyślnie wybrany zespół
    let currentNoteIndex = 0; // Indeks aktualnej notatki
    let currentPage = 1; // Aktualna strona paginacji
    const recordsPerPage = 5; // Liczba meczów na stronę

    chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
    if (message.action === "fetchData") {
        fetch("https://api.example.com/data")
            .then(response => response.json())
            .then(data => {
                sendResponse({ data: data }); // Wysyłamy odpowiedź
            })
            .catch(error => {
                sendResponse({ error: error.message }); // Wysyłamy odpowiedź w przypadku błędu
            });
        return true; // Zwracamy true, ponieważ odpowiedź będzie asynchroniczna
    }
    return false; // Zwracamy false, jeśli nie zamierzamy wysłać odpowiedzi
});

    // Funkcja do obsługi logowania przez Google
        function handleCredentialResponse(response) {
            const user = decodeJwt(response.credential);
            console.log("Zalogowany użytkownik:", user);
            localStorage.setItem('googleUser', JSON.stringify(user));
        }

        // Funkcja do dekodowania tokena JWT
        function decodeJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            return JSON.parse(atob(base64));
        }

    
    // Funkcja do autoryzacji i uzyskania tokena dostępu do Google Calendar
    async function authorize() {
        const client = google.accounts.oauth2.initTokenClient({
            client_id: '148953860327-72d408l9qvt34akmhaa1e37m4bvbto70.apps.googleusercontent.com',
            scope: 'https://www.googleapis.com/auth/calendar.events',
            callback: (response) => {
                if (response.access_token) {
                    localStorage.setItem('googleAccessToken', response.access_token);
                    console.log("Token dostępu:", response.access_token);
                }
            },
        });
        client.requestAccessToken();
    }

    // Funkcja do dodawania wydarzenia do Google Calendar
    async function addEventToGoogleCalendar(event) {
        const accessToken = localStorage.getItem('googleAccessToken');
        if (!accessToken) {
            alert("Najpierw zaloguj się przez Google.");
            return;
        }

        const eventDetails = {
            summary: event.name,
            location: event.location,
            description: event.notes,
            start: {
                dateTime: event.date, // Format: "2025-02-11T10:30:00"
                timeZone: 'Europe/Warsaw',
            },
            end: {
                dateTime: new Date(new Date(event.date).getTime() + 60 * 60 * 1000).toISOString(), // 1 godzina później
                timeZone: 'Europe/Warsaw',
            },
            reminders: {
                useDefault: false,
                overrides: [
                    { method: 'popup', minutes: event.reminder },
                ],
            },
        };

        try {
            const response = await fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(eventDetails),
            });

            const data = await response.json();
            console.log("Wydarzenie dodane do Google Calendar:", data);
            alert("Wydarzenie zostało dodane do Google Calendar!");
        } catch (error) {
            console.error("Błąd podczas dodawania wydarzenia:", error);
            alert("Wystąpił błąd podczas dodawania wydarzenia.");
        }
    }

    // Funkcja do dodawania wydarzenia
    function addEvent() {
        const selectedDate = new Date(currentWeekStart).toISOString().split('T')[0];
        localStorage.setItem("selectedDate", selectedDate);
        window.location.href = "add-event.html"; // Przekierowanie do strony dodawania wydarzeń
        console.log("Przekierowanie do strony dodawania wydarzeń."); // Log przekierowania
    }

    // Funkcja zmieniająca logo drużyny
    function changeLogo() {
        const teamSelector = document.getElementById('team-selector');
        const logo = document.getElementById('team-logo');
        logo.src = logos[teamSelector.value] || 'BAT Sierakowice.png';
        currentTeam = teamSelector.value;
        localStorage.setItem('currentTeam', currentTeam); // Zapisuje wybrany zespół
        loadNotes(); // Ładuje notatki dla nowej drużyny
        updateNotesNavigation(); // Aktualizuje przyciski nawigacji
        console.log(`Wybrano zespół: ${currentTeam}`);
    }

    // Funkcja ustawiająca dzisiejszą datę w polu daty
    function setTodayDate() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('game-date').value = today;
        console.log(`Ustawiono dzisiejszą datę: ${today}`); // Log ustawienia daty
    }

    // Funkcja rozpoczynająca mecz
    function startGame() {
        const team = document.getElementById('team-selector').value;
        const date = document.getElementById('game-date').value;

        if (!date) {
            alert("Proszę wybrać datę meczu!");
            console.log("Nie wybrano daty meczu."); // Log braku daty
            return;
        }

        localStorage.setItem("selectedTeam", team);
        localStorage.setItem("selectedDate", date);
        localStorage.removeItem("editMatchId");

        console.log(`Rozpoczęto mecz z zespołem: ${team}, data: ${date}`); // Log rozpoczęcia meczu
        window.location.href = "blania.html";
    }

    // Funkcja otwierająca formularz notatek
    function openNotesForm() {
        localStorage.setItem('currentTeam', currentTeam); // Zapisuje aktualnie wybrany zespół
        localStorage.removeItem('currentNoteIndex');
        console.log(`Otwieranie formularza notatek dla zespołu: ${currentTeam}`);
        window.location.href = 'notes-form.html';
    }

    // Funkcja zamykająca formularz notatek
    function closeNotesForm() {
        localStorage.removeItem('noteToEdit');
        console.log("Zamknięto formularz notatek."); // Log zamknięcia formularza
        window.location.href = 'main.html';
    }

    // Funkcja ustawiająca ocenę (gwiazdki)
    function setRating(rating) {
        document.querySelectorAll('.rating span').forEach((star, index) => {
            star.classList.toggle('active', index < rating);
        });
        console.log(`Ustawiono ocenę: ${rating} gwiazdek`); // Log ustawienia oceny
    }

    // Funkcja zapisująca notatkę
    function saveNote() {
        const note = {
            id: Date.now(), // Unikalne ID na podstawie znacznika czasu
            strengths: document.getElementById('notes-strengths').value,
            weaknesses: document.getElementById('notes-weaknesses').value,
            focus: document.getElementById('notes-focus').value,
            star: document.getElementById('notes-star').value,
            defender: document.getElementById('notes-defender').value,
            other: document.getElementById('notes-other').value,
            rating: document.querySelectorAll('.rating span.active').length
        };

        const team = localStorage.getItem('currentTeam');
        let notes = JSON.parse(localStorage.getItem('notes')) || {};

        if (!notes[team]) {
            notes[team] = []; // Utwórz pustą listę notatek dla nowej drużyny
        }

        const noteIndex = localStorage.getItem('currentNoteIndex');
        if (noteIndex !== null) {
            // Edycja istniejącej notatki
            notes[team][noteIndex] = note;
            console.log(`Zaktualizowano notatkę dla zespołu: ${team}`); // Log aktualizacji notatki
        } else {
            // Dodanie nowej notatki
            notes[team].push(note);
            console.log(`Dodano nową notatkę dla zespołu: ${team}`); // Log dodania notatki
        }

        localStorage.setItem('notes', JSON.stringify(notes)); // Zapisz notatki
        localStorage.removeItem('noteToEdit'); // Wyczyść dane edycji
        window.location.href = 'main.html'; // Powrót do głównej strony
    }

    // Funkcja ładująca notatki
    function loadNotes() {
        const notesDisplay = document.getElementById('notes-display');
        const teamNotes = notes[currentTeam] || []; // Pobierz notatki dla aktualnej drużyny

        if (teamNotes.length === 0) {
            notesDisplay.innerHTML = '<p>Tutaj dodaj swoje spostrzeżenia na temat przeciwnika. Kliknij "Dodaj".</p>';
            console.log(`Brak notatek dla zespołu: ${currentTeam}`); // Log braku notatek
        } else {
            const note = teamNotes[currentNoteIndex];
            notesDisplay.innerHTML = `
                <p><strong>Mocne strony:</strong> ${note.strengths}</p>
                <p><strong>Słabe strony:</strong> ${note.weaknesses}</p>
                <p><strong>Na co zwrócić uwagę:</strong> ${note.focus}</p>
                <p><strong>Gwiazda:</strong> ${note.star}</p>
                <p><strong>Kto mnie krył:</strong> ${note.defender}</p>
                <p><strong>Inne:</strong> ${note.other}</p>
                <p><strong>Ocena:</strong> ${'★'.repeat(note.rating)}</p>
            `;
            console.log(`Załadowano notatkę dla zespołu: ${currentTeam}, indeks: ${currentNoteIndex}`); // Log załadowania notatki
        }

        updateNotesNavigation(); // Aktualizuj przyciski nawigacji
    }

    // Funkcja aktualizująca przyciski nawigacji
    function updateNotesNavigation() {
        const teamNotes = notes[currentTeam] || [];
        const notesNavigation = document.getElementById('notes-navigation');

        // Zawsze pokazuj przycisk "Dodaj"
        const addButton = notesNavigation.querySelector('button[onclick="openNotesForm()"]');
        addButton.style.display = 'inline-block'; // Pokazuje przycisk "Dodaj"

        // Przyciski "Poprzednia", "Edytuj" i "Następna"
        const prevButton = notesNavigation.querySelector('button[onclick="prevNote()"]');
        const editButton = notesNavigation.querySelector('button[onclick="editNote()"]');
        const nextButton = notesNavigation.querySelector('button[onclick="nextNote()"]');

        if (teamNotes.length >= 1) {
            // Pokazuje przyciski, jeśli jest co najmniej jedna notatka
            prevButton.style.display = teamNotes.length >= 2 ? 'inline-block' : 'none'; // "Poprzednia" tylko dla 2+ notatek
            editButton.style.display = 'inline-block'; // "Edytuj" widoczny, gdy jest co najmniej jedna notatka
            nextButton.style.display = teamNotes.length >= 2 ? 'inline-block' : 'none'; // "Następna" tylko dla 2+ notatek
            console.log("Przyciski nawigacji są widoczne (co najmniej jedna notatka).");
        } else {
            // Ukrywa przyciski, jeśli nie ma notatek
            prevButton.style.display = 'none';
            editButton.style.display = 'none';
            nextButton.style.display = 'none';
            console.log("Przyciski nawigacji są ukryte (brak notatek).");
        }
    }

    // Funkcja przewijająca do poprzedniej notatki
    function prevNote() {
        if (currentNoteIndex > 0) {
            currentNoteIndex--;
            loadNotes();
            console.log(`Przewinięto do poprzedniej notatki. Aktualny indeks: ${currentNoteIndex}`); // Log przewijania
        }
    }

    // Funkcja przewijająca do następnej notatki
    function nextNote() {
        if (currentNoteIndex < notes[currentTeam].length - 1) {
            currentNoteIndex++;
            loadNotes();
            console.log(`Przewinięto do następnej notatki. Aktualny indeks: ${currentNoteIndex}`); // Log przewijania
        }
    }

    // Funkcja edytująca notatkę
    function editNote() {
        const teamNotes = notes[currentTeam] || [];
        if (teamNotes.length > 0) {
            const note = teamNotes[currentNoteIndex];
            localStorage.setItem('currentTeam', currentTeam);
            localStorage.setItem('currentNoteIndex', currentNoteIndex);
            localStorage.setItem('noteToEdit', JSON.stringify(note));
            console.log(`Edytowanie notatki dla zespołu: ${currentTeam}, indeks: ${currentNoteIndex}`); // Log edycji
            window.location.href = 'notes-form.html';
        }
    }

    // Funkcja edytująca mecz
    function editMatch(matchId) {
        const savedMatches = JSON.parse(localStorage.getItem("savedMatches")) || [];
        const matchToEdit = savedMatches.find(match => match.id === matchId);

        if (matchToEdit) {
            localStorage.setItem("selectedTeam", matchToEdit.team);
            localStorage.setItem("selectedDate", matchToEdit.date);
            localStorage.setItem("editMatchId", matchToEdit.id);
            console.log(`Edytowanie meczu: ${matchToEdit.team}, data: ${matchToEdit.date}`); // Log edycji meczu
            window.location.href = "blania.html"; // Przekierowanie do strony edycji
        } else {
            alert("Mecz nie został znaleziony.");
            console.log("Mecz nie został znaleziony."); // Log błędu
        }
    }

    // Funkcja przewijająca kalendarz
    function moveCalendar(days) {
        if (days === 1) {
            currentWeekStart.setDate(currentWeekStart.getDate() + 5); // Przesuwamy się o 5 dni do przodu
        } else if (days === -1) {
            currentWeekStart.setDate(currentWeekStart.getDate() - 5); // Przesuwamy się o 5 dni do tyłu
        }

        console.log(`Przewinięto kalendarz o ${days} dni. Aktualna data: ${currentWeekStart.toISOString().split('T')[0]}`); // Log przewijania kalendarza
        generateCalendar(); // Generujemy kalendarz na nowo
    }

    // Funkcja generująca kalendarz
    function generateCalendar() {
        const calendarWeek = document.querySelector('.calendar-week');
        calendarWeek.innerHTML = ""; // Czyści zawartość kalendarza

        // Generujemy 5 dni, zaczynając od currentWeekStart
        for (let i = 0; i < 5; i++) {
            const day = new Date(currentWeekStart);
            day.setDate(currentWeekStart.getDate() + i);

            const dayElement = document.createElement('div');
            dayElement.classList.add('calendar-day');
            if (day < new Date()) dayElement.classList.add('past'); // Dodaje klasę "past" dla dni z przeszłości
            if (day.toDateString() === new Date().toDateString()) dayElement.classList.add('current'); // Dodaje klasę "current" dla bieżącego dnia

            // Formatowanie daty: dd.mm.rrrr + nazwa dnia tygodnia (skrócona)
            const options = { weekday: 'short', day: '2-digit', month: '2-digit', year: 'numeric' };
            const formattedDate = new Intl.DateTimeFormat('pl-PL', options).format(day);
            const dayHeader = document.createElement('h3');
            dayHeader.textContent = formattedDate.replace('.', ''); // Usuwa kropkę po skrócie dnia
            dayHeader.setAttribute('data-date', day.toISOString().split('T')[0]); // Zapisujemy datę w formacie ISO
            dayElement.appendChild(dayHeader);

            const eventsList = document.createElement('div');
            eventsList.className = 'events-container';
            dayElement.appendChild(eventsList);

            // Sprawdź, czy są wydarzenia w tym dniu
            const savedEvents = JSON.parse(localStorage.getItem('savedEvents')) || [];
            const hasEvents = savedEvents.some(event => new Date(event.date).toISOString().split('T')[0] === day.toISOString().split('T')[0]);

            if (!hasEvents) {
                const noEventsText = document.createElement('p');
                noEventsText.textContent = "Dziś regeneracja? Jeśli masz jakiś plan, kliknij '+ Dodaj wydarzenie'.";
                noEventsText.style.fontStyle = 'italic';
                noEventsText.style.color = '#666';
                eventsList.appendChild(noEventsText);
            }

            calendarWeek.appendChild(dayElement);
        }

        loadEvents(); // Ładuje wydarzenia dla wygenerowanych dni
    }

    // Funkcja ładująca wydarzenia
    function loadEvents() {
        const savedEvents = JSON.parse(localStorage.getItem('savedEvents')) || [];
        const eventIcons = {
            'mecz-ligowy': 'match.png',
            'trening': 'training.png',
            'fizjoterapeuta': 'physio.png',
            'mecz-sparingowy': 'friendly.png',
            'turniej': 'tournament.png',
            'oboz': 'camp.png',
            'bus': 'bus.png'
        };

        savedEvents.forEach(event => {
            const eventDate = new Date(event.date).toISOString().split('T')[0];
            document.querySelectorAll('.calendar-day').forEach(dayElement => {
                const dayDate = new Date(dayElement.querySelector('h3').getAttribute('data-date')).toISOString().split('T')[0];
                if (dayDate === eventDate) {
                    const eventItem = document.createElement('div');
                    eventItem.className = 'event-item';
                    eventItem.setAttribute('data-event-id', event.id);

                    eventItem.onclick = function () {
                        editEvent(event.id);
                    };

                    const icon = document.createElement('div');
                    icon.className = 'event-icon';
                    icon.style.backgroundImage = `url(${eventIcons[event.type]})`;
                    icon.style.backgroundSize = 'cover';
                    eventItem.appendChild(icon);

                    const text = document.createElement('div');
                    text.className = 'event-text';
                    text.innerHTML = `
                        <strong>${event.date.split('T')[1].substring(0, 5)} ${event.name.substring(0, 20)}${event.name.length > 20 ? '...' : ''}</strong><br>
                        ${event.name.length > 20 ? `<small>${event.name.substring(20)}</small>` : ''}
                        <small>${event.location}</small>
                    `;
                    eventItem.appendChild(text);

                    dayElement.querySelector('.events-container').appendChild(eventItem);
                }
            });
        });
    }

    // Funkcja edytująca event
    function editEvent(eventId) {
        const savedEvents = JSON.parse(localStorage.getItem('savedEvents')) || [];
        const eventToEdit = savedEvents.find(event => event.id === eventId);

        if (eventToEdit) {
            localStorage.setItem("selectedDate", eventToEdit.date.split('T')[0]); // Tylko data
            localStorage.setItem("editEventId", eventToEdit.id);
            window.location.href = "add-event.html"; // Przekierowanie do strony edycji
        } else {
            alert("Event nie został znaleziony.");
        }
    }

    // Funkcja ładująca zapisane mecze
    function loadSavedMatches() {
        const tableBody = document.querySelector("#matches-table tbody");
        let savedMatches = JSON.parse(localStorage.getItem("savedMatches")) || [];

        savedMatches.sort((a, b) => new Date(b.date) - new Date(a.date));

        const start = (currentPage - 1) * recordsPerPage;
        const end = start + recordsPerPage;
        const paginatedMatches = savedMatches.slice(start, end);

        tableBody.innerHTML = "";
        paginatedMatches.forEach((match) => {
            const row = document.createElement("tr");
            ["team", "date", "total", "Asy", "Blok", "Zb", "Prze"].forEach(stat => {
                const cell = document.createElement("td");
                cell.textContent = match[stat] || 0;
                row.appendChild(cell);
            });

            const actionCell = document.createElement("td");
            const actionContainer = document.createElement("div");
            actionContainer.classList.add("action-container");

            const editButton = document.createElement("button");
            editButton.innerHTML = '<img src="edit.png" alt="Edytuj" class="action-icon">';
            editButton.classList.add("action-btn", "edit-btn");
            editButton.onclick = function () {
                editMatch(match.id); // Wywołanie funkcji editMatch
            };
            actionContainer.appendChild(editButton);

            const deleteButton = document.createElement("button");
            deleteButton.innerHTML = '<img src="trash.png" alt="Usuń" class="action-icon">';
            deleteButton.classList.add("action-btn", "delete-btn");
            deleteButton.onclick = function () {
                const confirmDelete = confirm("Czy na pewno chcesz usunąć ten mecz?");
                if (confirmDelete) {
                    savedMatches = savedMatches.filter(m => m.id !== match.id);
                    localStorage.setItem("savedMatches", JSON.stringify(savedMatches));
                    loadSavedMatches();
                    console.log(`Usunięto mecz: ${match.team}, data: ${match.date}`); // Log usunięcia meczu
                }
            };
            actionContainer.appendChild(deleteButton);

            if (match.streamLink && match.streamLink.trim() !== "") {
                const youtubeButton = document.createElement("button");
                youtubeButton.innerHTML = '<img src="youtube.png" alt="YouTube" class="action-icon">';
                youtubeButton.classList.add("action-btn", "yt-btn");
                youtubeButton.onclick = function() {
                    window.open(match.streamLink, "_blank"); 
                };
                actionContainer.appendChild(youtubeButton);
            }

            actionCell.appendChild(actionContainer);
            row.appendChild(actionCell);
            tableBody.appendChild(row);
        });

        // Pokazuj przyciski nawigacji tylko, jeśli jest co najmniej 6 rekordów
        const pagination = document.getElementById("pagination");
        if (savedMatches.length > recordsPerPage) {
            pagination.style.display = 'flex'; // Pokazuje przyciski nawigacji
            console.log("Przyciski nawigacji są widoczne (co najmniej 6 rekordów).");
        } else {
            pagination.style.display = 'none'; // Ukrywa przyciski nawigacji
            console.log("Przyciski nawigacji są ukryte (mniej niż 6 rekordów).");
        }

        document.getElementById("prev-btn").disabled = currentPage === 1;
        document.getElementById("next-btn").disabled = currentPage * recordsPerPage >= savedMatches.length;

        console.log(`Załadowano mecze: ${paginatedMatches.length} na stronie ${currentPage}`); // Log załadowania meczów
    }

    // Funkcja zmieniająca stronę w paginacji
    function changePage(direction) {
        currentPage += direction;
        console.log(`Zmieniono stronę na: ${currentPage}`); // Log zmiany strony
        loadSavedMatches();
    }

    // Funkcja wywoływana po załadowaniu strony
    window.onload = function () {
        setTodayDate();

        // Odczytaj zapisany zespół z localStorage
        const savedTeam = localStorage.getItem('currentTeam');
        if (savedTeam) {
            currentTeam = savedTeam;
            document.getElementById('team-selector').value = currentTeam; // Ustaw wybrany zespół w select
            changeLogo(); // Załaduj logo i notatki dla zapisanego zespołu
        } else {
            changeLogo(); // Domyślnie załaduj BAT Sierakowice
        }

        generateCalendar();
        loadSavedMatches();
        loadNotes(); // Ładuje notatki na starcie
        updateNotesNavigation(); // Inicjalizuje przyciski nawigacji
        console.log("Strona została załadowana.");
    };
</script>
 
</body>
</html>
