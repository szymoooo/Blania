<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mecze Blanki</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
    /* Style dla kontenera logowania Google */
    .google-login-container {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    #user-info {
        position: absolute;
        top: 20px;
        right: 120px;
        background: #f8f9fa;
        padding: 5px 10px;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    #logout-btn {
        background-color: #dc3545;
        color: white;
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    /* Reszta styli pozostaje bez zmian */
    body {
        font-family: 'Roboto', sans-serif;
        background-color: #ffffff;
        color: #333;
        padding: 0;
        margin: 0;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
    }

    header {
        font-size: 28px;
        font-weight: bold;
        text-align: center;
        margin: 10px 0;
        color: #333;
        margin-top: 60px;
    }

    .calendar-container {
        width: 1200px;
        margin: 20px auto;
        background-color: #f9f9f9;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        border: 2px solid #0078d7;
        position: relative;
        padding-bottom: 80px;
    }

    .calendar-week {
        display: flex;
        justify-content: space-between;
        gap: 10px;
    }

    .calendar-day {
        flex: 1;
        text-align: center;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background-color: #fff;
        min-height: 150px;
        max-height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        min-width: 120px;
        overflow-y: auto;
    }

    .calendar-day h3 {
        white-space: nowrap;
        font-size: 14px;
        margin: 0;
    }

    .calendar-day.past {
        background-color: #f8f9fa;
        opacity: 0.7;
    }

    .calendar-day.current {
        background-color: #e3f2fd;
        border: 2px solid #2196f3;
    }

    .event-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px;
        margin: 4px 0;
        background-color: #fff;
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        height: 80px;
        cursor: pointer;
    }

    .event-icon {
        width: 32px;
        height: 32px;
        background-color: #eee;
        border-radius: 4px;
        flex-shrink: 0;
        background-size: cover;
    }

    .event-text {
        flex-grow: 1;
        text-align: left;
        font-size: 14px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        line-height: 1.2;
    }

    .event-text strong {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 200px;
        margin-bottom: 2px;
    }

    .event-text small {
        font-size: 12px;
        margin-top: 2px;
    }

    .navigation-buttons {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 50px;
    }

    .btn-prev-calendar, .btn-next-calendar {
        background-color: #0078d7;
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
    }

    .btn-add-event {
        background-color: #28a745;
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
    }

    .btn-start-game {
        background-color: #dc3545;
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
    }

    /* Reszta styli pozostaje bez zmian */
    .team-and-notes-container {
        display: flex;
        gap: 20px;
        width: 1200px;
        margin: 20px auto;
        position: relative;
    }

    .team-selection-container {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 20px;
        width: 600px;
        height: 320px;
        border: 2px solid #0078d7;
        border-radius: 8px;
        padding: 15px;
        background-color: #f8f9fa;
        position: relative;
    }

    .team-logo-container {
        flex-shrink: 0;
        display: flex;
        justify-content: left;
        align-items: center;
    }

    .team-logo {
        width: 300px;
        height: 300px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .team-info-container {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
        position: relative;
        padding-bottom: 80px;
    }

    .team-selector, .date-input {
        width: 200px;
        padding: 8px;
        font-size: 14px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f9f9f9;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        margin-bottom: 10px;
    }

    .scouting-notes {
        width: 600px;
        height: 330px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
        border: 2px solid #0078d7;
        border-radius: 8px;
        padding: 10px;
        background-color: #f8f9fa;
        position: relative;
    }

    .notes-display {
        padding: 10px;
        background-color: #fff;
        border-radius: 4px;
        margin-bottom: 10px;
        max-height: 200px;
        overflow-y: auto;
    }

    .notes-display p {
        margin: 5px 0;
        text-align: left;
        word-wrap: break-word;
        white-space: pre-wrap;
        font-size: 14px;
    }

    .notes-navigation {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
    }

    .btn-prev-note, .btn-next-note {
        background-color: #0078d7;
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
    }

    .btn-add-note {
        background-color: #28a745;
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
    }

    .btn-edit-note {
        background-color: #ffc107;
        color: black;
        padding: 8px 16px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
    }

    .stats-container {
        width: 1200px;
        margin: 20px auto;
        border: 2px solid #0078d7;
        border-radius: 8px;
        padding: 20px;
        background-color: #f9f9f9;
    }

    #matches-table {
        width: 100%;
        border-collapse: collapse;
    }

    #matches-table th, #matches-table td {
        padding: 8px;
        font-size: 14px;
        text-align: center;
        border: 1px solid #ddd;
        white-space: nowrap;
    }

    #matches-table th {
        background-color: #f2f2f2;
    }

    .btn-edit-stats {
        background-color: #ffc107;
        color: black;
        padding: 8px 16px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
    }

    .btn-delete-stats {
        background-color: #dc3545;
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
    }

    .btn-youtube {
        background-color: #ff0000;
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
    }

    .btn-prev-stats, .btn-next-stats {
        background-color: #0078d7;
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
    }

    .btn-prev-calendar:hover, .btn-prev-calendar:focus,
    .btn-add-event:hover, .btn-add-event:focus,
    .btn-next-calendar:hover, .btn-next-calendar:focus,
    .btn-start-game:hover, .btn-start-game:focus,
    .btn-prev-note:hover, .btn-prev-note:focus,
    .btn-add-note:hover, .btn-add-note:focus,
    .btn-edit-note:hover, .btn-edit-note:focus,
    .btn-next-note:hover, .btn-next-note:focus,
    .btn-edit-stats:hover, .btn-edit-stats:focus,
    .btn-delete-stats:hover, .btn-delete-stats:focus,
    .btn-youtube:hover, .btn-youtube:focus,
    .btn-prev-stats:hover, .btn-prev-stats:focus,
    .btn-next-stats:hover, .btn-next-stats:focus {
        opacity: 0.9;
        transform: scale(1.05);
        transition: all 0.3s ease;
    }

    @media screen and (max-width: 768px) {
        .team-and-notes-container {
            flex-direction: column;
        }

        .calendar-week {
            flex-direction: column;
        }

        .navigation-buttons, .notes-navigation {
            flex-direction: column;
            gap: 5px;
        }
    }
</style>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <!-- Sekcja logowania Google i informacji o uÅ¼ytkowniku -->
    <div class="google-login-container">
        <div id="user-info" style="display:none;">
            Zalogowany jako: <span id="user-name"></span>
            <button id="logout-btn" onclick="logout()">Wyloguj</button>
        </div>
        <div id="g_id_onload"
             data-client_id="148953860327-72d408l9qvt34akmhaa1e37m4bvbto70.apps.googleusercontent.com"
             data-callback="handleCredentialResponse">
        </div>
        <div class="g_id_signin"
             data-type="standard"
             data-size="large"
             data-theme="outline"
             data-text="sign_in_with"
             data-shape="rectangular"
             data-logo_alignment="left">
        </div>
    </div>

    <header>
        <h2>MÃ³j planner:</h2>
    </header>
    
    <!-- Sekcja kalendarza -->
    <div class="calendar-container">
        <div class="calendar-week">
            <!-- Dni tygodnia bÄdÄ generowane dynamicznie -->
        </div>
        <div class="navigation-buttons">
            <button class="btn-prev-calendar" onclick="moveCalendar(-1)">Poprzednia</button>
            <button class="btn-add-event" onclick="addEvent()">+ Dodaj wydarzenie</button>
            <button class="btn-next-calendar" onclick="moveCalendar(1)">NastÄpna</button>
        </div>
    </div>

    <header>
        <h2>NajbliÅ¼szy przeciwnik:</h2>
    </header>

    <!-- Kontener na wybÃ³r przeciwnika i notatki -->
    <div class="team-and-notes-container">
        <!-- WybÃ³r przeciwnika -->
        <div class="team-selection-container">
            <div class="team-logo-container">
                <img id="team-logo" src="BAT Sierakowice.png" alt="Logo druÅ¼yny" class="team-logo" style="width: 300px; height: 300px;">
            </div>
            <div class="team-info-container">
                <select id="team-selector" class="team-selector" onchange="changeLogo()">
                    <option value="BAT Sierakowice">BAT Sierakowice</option>
                    <option value="BAT Kartuzy">BAT Kartuzy</option>
                    <option value="Bryza Pruszcz Gd">Bryza Pruszcz Gd</option>
                    <option value="ElblÄg">ElblÄg</option>
                    <option value="Pruszcz GdaÅski 1">Pruszcz GdaÅski 1</option>
                    <option value="Pruszcz GdaÅski 2">Pruszcz GdaÅski 2</option>
                    <option value="BK VLCI Å½ÄÃ¡r">BK VLCI Å½ÄÃ¡r</option>
                    <option value="BKM Å½ilina">BKM Å½ilina</option>
                    <option value="MOSiR Bochnia">MOSiR Bochnia</option>
                    <option value="UKS Å»AK Nowy SÄcz">UKS Å»AK Nowy SÄcz</option>
                    <option value="Young Angels KoÅ¡ice">Young Angels KoÅ¡ice</option>
                </select>
                <input type="date" id="game-date" class="date-input">
                <button class="btn-start-game" onclick="startGame()">Gramy</button>
            </div>
        </div>

        <!-- Pole na notatki -->
        <div class="scouting-notes">
            <div class="notes-display" id="notes-display">
                <p>Tutaj dodaj swoje spostrzeÅ¼enia na temat przeciwnika. Kliknij "Dodaj".</p>
            </div>
            <div class="notes-navigation" id="notes-navigation">
                <button class="btn-prev-note" onclick="prevNote()">Poprzednia</button>
                <button class="btn-edit-note" onclick="editNote()">Edytuj</button>
                <button class="btn-add-note" onclick="openNotesForm()">Dodaj</button>
                <button class="btn-next-note" onclick="nextNote()">NastÄpna</button>
            </div>
        </div>
    </div>

    <header>
        <h2>Moje statystyki:</h2>
    </header>
    <div class="stats-container">
        <table id="matches-table">
            <thead>
                <tr>
                    <th>DruÅ¼yna</th>
                    <th>Data meczu</th>
                    <th>Punkty</th>
                    <th>Asysty</th>
                    <th>Bloki</th>
                    <th>ZbiÃ³rki</th>
                    <th>Przechwyty</th>
                    <th></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div id="pagination" style="margin-top: 10px;">
            <button id="prev-btn" class="btn-prev-stats" onclick="changePage(-1)" disabled>Poprzednia</button>
            <button id="next-btn" class="btn-next-stats" onclick="changePage(1)" disabled>NastÄpna</button>
        </div>
    </div>

<footer style="margin: 20px 0; text-align: center; padding: 10px; font-size: 12px;">
    <a href="privacy.html" target="_blank">Polityka PrywatnoÅci</a> | 
    &copy; 2023 Mecze Blanki. Wszelkie prawa zastrzeÅ¼one.
</footer>

<script>
    // SÅownik z logo druÅ¼yn
    const logos = {
        'BAT Sierakowice': 'BAT Sierakowice.png',
        'BAT Kartuzy': 'BAT Kartuzy.png',
        'Bryza Pruszcz Gd': 'Bryza Pruszcz Gd.png',
        'ElblÄg': 'Elblag.png',
        'Pruszcz GdaÅski 1': 'Pruszcz Gdanski 1.png',
        'Pruszcz GdaÅski 2': 'Pruszcz Gdanski 2.png',
        'BK VLCI Å½ÄÃ¡r': 'BK VLCI Zdar.png',
        'BKM Å½ilina': 'BKM Zilina.png',
        'MOSiR Bochnia': 'MOSiR Bochnia.png',
        'UKS Å»AK Nowy SÄcz': 'UKS ZAK Nowy Sacz.png',
        'Young Angels KoÅ¡ice': 'Young Angels Kosice.png'
    };

    // Zmienne globalne
    let currentWeekStart = new Date();
    let notes = JSON.parse(localStorage.getItem('notes')) || {};
    let currentTeam = 'BAT Sierakowice';
    let currentNoteIndex = 0;
    let currentPage = 1;
    const recordsPerPage = 5;

    // Funkcje do obsÅugi logowania Google
    function handleCredentialResponse(response) {
        const user = decodeJwt(response.credential);
        console.log("Zalogowany uÅ¼ytkownik:", user);
        localStorage.setItem('googleUser', JSON.stringify(user));
        
        // Aktualizuj UI
        document.getElementById('user-info').style.display = 'block';
        document.getElementById('user-name').textContent = user.name;
        document.getElementById('logout-btn').style.display = 'inline-block';
        
    // Autoryzacja do Google Calendar API
    async function authorize() {
        return new Promise((resolve, reject) => {
            const client = google.accounts.oauth2.initTokenClient({
                client_id: '148953860327-72d408l9qvt34akmhaa1e37m4bvbto70.apps.googleusercontent.com',
                scope: 'https://www.googleapis.com/auth/calendar.events',
                prompt: 'consent',
                callback: (response) => {
                    if (response.access_token) {
                        localStorage.setItem('googleAccessToken', response.access_token);
                        resolve(response.access_token);
                    } else {
                        handleAuthError(response.error);
                        reject(response.error);
                    }
                },
            });
            client.requestAccessToken();
        });
    }

    function handleAuthError(error) {
        console.error('BÅÄd autoryzacji:', error);
        let message = 'WystÄpiÅ bÅÄd podczas logowania.';
        
        if (error === 'access_denied') {
            message = 'Aby korzystaÄ z tej funkcji, musisz byÄ zatwierdzonym testerem. ' + 
                     'Skontaktuj siÄ z administratorem aplikacji.';
        }
        
        alert(message);
    }
   
    // Dodawanie wydarzenia do Google Calendar
    async function addEventToGoogleCalendar(event) {
        try {
            if (!checkLoginStatus()) {
                alert("ProszÄ zalogowaÄ siÄ przez Google");
                return null;
            }

            let accessToken = localStorage.getItem('googleAccessToken');
            if (!accessToken) {
                const authorized = await authorize();
                if (!authorized) {
                    throw new Error("Autoryzacja nie powiodÅa siÄ");
                }
                accessToken = localStorage.getItem('googleAccessToken');
            }

            if (!event.date || !event.name) {
                throw new Error("Wydarzenie musi mieÄ datÄ i nazwÄ");
            }

            const startDate = new Date(event.date);
            if (isNaN(startDate.getTime())) {
                throw new Error("NieprawidÅowy format daty");
            }

            const endDate = new Date(startDate.getTime() + (event.duration || 60) * 60 * 1000);

            const eventDetails = {
                summary: event.name,
                location: event.location || '',
                description: event.notes || '',
                start: {
                    dateTime: startDate.toISOString(),
                    timeZone: 'Europe/Warsaw',
                },
                end: {
                    dateTime: endDate.toISOString(),
                    timeZone: 'Europe/Warsaw',
                },
                reminders: {
                    useDefault: false,
                    overrides: [
                        { method: 'popup', minutes: event.reminder || 30 },
                    ],
                },
            };

            const response = await fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(eventDetails),
            });

            if (!response.ok) {
                if (response.status === 401) {
                    localStorage.removeItem('googleAccessToken');
                    return addEventToGoogleCalendar(event);
                }
                const errorData = await response.json();
                throw new Error(errorData.error?.message || "BÅÄd podczas dodawania wydarzenia");
            }

            const data = await response.json();
            console.log("Wydarzenie dodane:", data);
            return data;
        } catch (error) {
            console.error("BÅÄd:", error);
            throw error;
        }
    }

    // Funkcja do dodawania wydarzenia
    function addEvent() {
        if (!checkLoginStatus()) {
            alert("ProszÄ zalogowaÄ siÄ przez Google przed dodaniem wydarzenia");
            return;
        }
        
        const selectedDate = new Date(currentWeekStart).toISOString().split('T')[0];
        localStorage.setItem("selectedDate", selectedDate);
        window.location.href = "add-event.html";
    }

    // Reszta funkcji pozostaje bez zmian
    function changeLogo() {
        const teamSelector = document.getElementById('team-selector');
        const logo = document.getElementById('team-logo');
        logo.src = logos[teamSelector.value] || 'BAT Sierakowice.png';
        currentTeam = teamSelector.value;
        localStorage.setItem('currentTeam', currentTeam);
        loadNotes();
        updateNotesNavigation();
    }

    function setTodayDate() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('game-date').value = today;
    }

    function startGame() {
        const team = document.getElementById('team-selector').value;
        const date = document.getElementById('game-date').value;

        if (!date) {
            alert("ProszÄ wybraÄ datÄ meczu!");
            return;
        }

        localStorage.setItem("selectedTeam", team);
        localStorage.setItem("selectedDate", date);
        localStorage.removeItem("editMatchId");

        window.location.href = "blania.html";
    }

    function openNotesForm() {
        localStorage.setItem('currentTeam', currentTeam);
        localStorage.removeItem('currentNoteIndex');
        window.location.href = 'notes-form.html';
    }

    function loadNotes() {
        const notesDisplay = document.getElementById('notes-display');
        const teamNotes = notes[currentTeam] || [];

        if (teamNotes.length === 0) {
            notesDisplay.innerHTML = '<p>Tutaj dodaj swoje spostrzeÅ¼enia na temat przeciwnika. Kliknij "Dodaj".</p>';
        } else {
            const note = teamNotes[currentNoteIndex];
            notesDisplay.innerHTML = `
                <p><strong>Mocne strony:</strong> ${note.strengths}</p>
                <p><strong>SÅabe strony:</strong> ${note.weaknesses}</p>
                <p><strong>Na co zwrÃ³ciÄ uwagÄ:</strong> ${note.focus}</p>
                <p><strong>Gwiazda:</strong> ${note.star}</p>
                <p><strong>Kto mnie kryÅ:</strong> ${note.defender}</p>
                <p><strong>Inne:</strong> ${note.other}</p>
                <p><strong>Ocena:</strong> ${'â'.repeat(note.rating)}</p>
            `;
        }

        updateNotesNavigation();
    }

    function updateNotesNavigation() {
        const teamNotes = notes[currentTeam] || [];
        const notesNavigation = document.getElementById('notes-navigation');

        const addButton = notesNavigation.querySelector('button[onclick="openNotesForm()"]');
        addButton.style.display = 'inline-block';

        const prevButton = notesNavigation.querySelector('button[onclick="prevNote()"]');
        const editButton = notesNavigation.querySelector('button[onclick="editNote()"]');
        const nextButton = notesNavigation.querySelector('button[onclick="nextNote()"]');

        if (teamNotes.length >= 1) {
            prevButton.style.display = teamNotes.length >= 2 ? 'inline-block' : 'none';
            editButton.style.display = 'inline-block';
            nextButton.style.display = teamNotes.length >= 2 ? 'inline-block' : 'none';
        } else {
            prevButton.style.display = 'none';
            editButton.style.display = 'none';
            nextButton.style.display = 'none';
        }
    }

    function prevNote() {
        if (currentNoteIndex > 0) {
            currentNoteIndex--;
            loadNotes();
        }
    }

    function nextNote() {
        if (currentNoteIndex < notes[currentTeam].length - 1) {
            currentNoteIndex++;
            loadNotes();
        }
    }

    function editNote() {
        const teamNotes = notes[currentTeam] || [];
        if (teamNotes.length > 0) {
            const note = teamNotes[currentNoteIndex];
            localStorage.setItem('currentTeam', currentTeam);
            localStorage.setItem('currentNoteIndex', currentNoteIndex);
            localStorage.setItem('noteToEdit', JSON.stringify(note));
            window.location.href = 'notes-form.html';
        }
    }

    function moveCalendar(days) {
        if (days === 1) {
            currentWeekStart.setDate(currentWeekStart.getDate() + 5);
        } else if (days === -1) {
            currentWeekStart.setDate(currentWeekStart.getDate() - 5);
        }
        generateCalendar();
    }

    function generateCalendar() {
        const calendarWeek = document.querySelector('.calendar-week');
        calendarWeek.innerHTML = "";

        for (let i = 0; i < 5; i++) {
            const day = new Date(currentWeekStart);
            day.setDate(currentWeekStart.getDate() + i);

            const dayElement = document.createElement('div');
            dayElement.classList.add('calendar-day');
            if (day < new Date()) dayElement.classList.add('past');
            if (day.toDateString() === new Date().toDateString()) dayElement.classList.add('current');

            const options = { weekday: 'short', day: '2-digit', month: '2-digit', year: 'numeric' };
            const formattedDate = new Intl.DateTimeFormat('pl-PL', options).format(day);
            const dayHeader = document.createElement('h3');
            dayHeader.textContent = formattedDate.replace('.', '');
            dayHeader.setAttribute('data-date', day.toISOString().split('T')[0]);
            dayElement.appendChild(dayHeader);

            const eventsList = document.createElement('div');
            eventsList.className = 'events-container';
            dayElement.appendChild(eventsList);

            const savedEvents = JSON.parse(localStorage.getItem('savedEvents')) || [];
            const hasEvents = savedEvents.some(event => new Date(event.date).toISOString().split('T')[0] === day.toISOString().split('T')[0]);

            if (!hasEvents) {
                const noEventsText = document.createElement('p');
                noEventsText.textContent = "DziÅ regeneracja? JeÅli masz jakiÅ plan, kliknij '+ Dodaj wydarzenie'.";
                noEventsText.style.fontStyle = 'italic';
                noEventsText.style.color = '#666';
                eventsList.appendChild(noEventsText);
            }

            calendarWeek.appendChild(dayElement);
        }

        loadEvents();
    }

    function loadEvents() {
        const savedEvents = JSON.parse(localStorage.getItem('savedEvents')) || [];
        const eventIcons = {
            'mecz-ligowy': 'match.png',
            'trening': 'training.png',
            'fizjoterapeuta': 'physio.png',
            'mecz-sparingowy': 'friendly.png',
            'turniej': 'tournament.png',
            'oboz': 'camp.png',
            'bus': 'bus.png'
        };

        savedEvents.forEach(event => {
            const eventDate = new Date(event.date).toISOString().split('T')[0];
            document.querySelectorAll('.calendar-day').forEach(dayElement => {
                const dayDate = new Date(dayElement.querySelector('h3').getAttribute('data-date')).toISOString().split('T')[0];
                if (dayDate === eventDate) {
                    const eventItem = document.createElement('div');
                    eventItem.className = 'event-item';
                    eventItem.setAttribute('data-event-id', event.id);

                    eventItem.onclick = function () {
                        editEvent(event.id);
                    };

                    const icon = document.createElement('div');
                    icon.className = 'event-icon';
                    icon.style.backgroundImage = `url(${eventIcons[event.type]})`;
                    icon.style.backgroundSize = 'cover';
                    eventItem.appendChild(icon);

                    const text = document.createElement('div');
                    text.className = 'event-text';
                    text.innerHTML = `
                        <strong>${event.date.split('T')[1].substring(0, 5)} ${event.name.substring(0, 20)}${event.name.length > 20 ? '...' : ''}</strong><br>
                        ${event.name.length > 20 ? `<small>${event.name.substring(20)}</small>` : ''}
                        <small>${event.location}</small>
                    `;
                    eventItem.appendChild(text);

                    dayElement.querySelector('.events-container').appendChild(eventItem);
                }
            });
        });
    }

    function editEvent(eventId) {
        const savedEvents = JSON.parse(localStorage.getItem('savedEvents')) || [];
        const eventToEdit = savedEvents.find(event => event.id === eventId);

        if (eventToEdit) {
            localStorage.setItem("selectedDate", eventToEdit.date.split('T')[0]);
            localStorage.setItem("editEventId", eventToEdit.id);
            window.location.href = "add-event.html";
        } else {
            alert("Event nie zostaÅ znaleziony.");
        }
    }

    function loadSavedMatches() {
        const tableBody = document.querySelector("#matches-table tbody");
        let savedMatches = JSON.parse(localStorage.getItem("savedMatches")) || [];

        savedMatches.sort((a, b) => new Date(b.date) - new Date(a.date));

        const start = (currentPage - 1) * recordsPerPage;
        const end = start + recordsPerPage;
        const paginatedMatches = savedMatches.slice(start, end);

        tableBody.innerHTML = "";
        paginatedMatches.forEach((match) => {
            const row = document.createElement("tr");
            ["team", "date", "total", "Asy", "Blok", "Zb", "Prze"].forEach(stat => {
                const cell = document.createElement("td");
                cell.textContent = match[stat] || 0;
                row.appendChild(cell);
            });

            const actionCell = document.createElement("td");
            const actionContainer = document.createElement("div");
            actionContainer.classList.add("action-container");

            const editButton = document.createElement("button");
            editButton.innerHTML = '<img src="edit.png" alt="Edytuj" class="action-icon">';
            editButton.classList.add("action-btn", "edit-btn");
            editButton.onclick = function () {
                editMatch(match.id);
            };
            actionContainer.appendChild(editButton);

            const deleteButton = document.createElement("button");
            deleteButton.innerHTML = '<img src="trash.png" alt="UsuÅ" class="action-icon">';
            deleteButton.classList.add("action-btn", "delete-btn");
            deleteButton.onclick = function () {
                const confirmDelete = confirm("Czy na pewno chcesz usunÄÄ ten mecz?");
                if (confirmDelete) {
                    savedMatches = savedMatches.filter(m => m.id !== match.id);
                    localStorage.setItem("savedMatches", JSON.stringify(savedMatches));
                    loadSavedMatches();
                }
            };
            actionContainer.appendChild(deleteButton);

            if (match.streamLink && match.streamLink.trim() !== "") {
                const youtubeButton = document.createElement("button");
                youtubeButton.innerHTML = '<img src="youtube.png" alt="YouTube" class="action-icon">';
                youtubeButton.classList.add("action-btn", "yt-btn");
                youtubeButton.onclick = function() {
                    window.open(match.streamLink, "_blank"); 
                };
                actionContainer.appendChild(youtubeButton);
            }

            actionCell.appendChild(actionContainer);
            row.appendChild(actionCell);
            tableBody.appendChild(row);
        });

        const pagination = document.getElementById("pagination");
        if (savedMatches.length > recordsPerPage) {
            pagination.style.display = 'flex';
        } else {
            pagination.style.display = 'none';
        }

        document.getElementById("prev-btn").disabled = currentPage === 1;
        document.getElementById("next-btn").disabled = currentPage * recordsPerPage >= savedMatches.length;
    }

    function changePage(direction) {
        currentPage += direction;
        loadSavedMatches();
    }

    // Inicjalizacja strony
    window.onload = function () {
        setTodayDate();

        // SprawdÅº czy uÅ¼ytkownik jest zalogowany
        const user = JSON.parse(localStorage.getItem('googleUser'));
        if (user) {
            document.getElementById('user-info').style.display = 'block';
            document.getElementById('user-name').textContent = user.name;
            document.getElementById('logout-btn').style.display = 'inline-block';
        }

        const savedTeam = localStorage.getItem('currentTeam');
        if (savedTeam) {
            currentTeam = savedTeam;
            document.getElementById('team-selector').value = currentTeam;
            changeLogo();
        } else {
            changeLogo();
        }

        generateCalendar();
        loadSavedMatches();
        loadNotes();
        updateNotesNavigation();
    };
</script>
</body>
</html>
